# 市场情绪指标策略（Market Sentiment Strategy）

## 策略概述

市场情绪指标策略是一种基于市场情绪数据的量化交易策略，通过监测市场情绪指标和技术分析指标的变化，在极端情绪区域进行逆向投资。该策略主要针对ETF等宽基指数产品，利用市场恐慌情绪作为买入信号，过度乐观情绪作为卖出信号，结合趋势识别和仓位管理，实现低买高卖的交易策略。

## 核心理念

1. **情绪逆向投资**：在市场极度恐慌时买入，在市场过度乐观时卖出
2. **多维度情绪度量**：综合考虑多个指数的技术指标、波动率、RSI等数据
3. **动态仓位管理**：根据市场情绪程度和波动环境动态调整仓位大小
4. **阶梯式止盈机制**：设置多个止盈阈值，随着情绪回升逐步减仓
5. **趋势识别与风险控制**：识别下跌趋势时避免操作，设置最大回撤限制

## 情绪指标构建

策略使用综合情绪指标，由以下数据源和指标构成：

1. **数据源**：
   - 上证指数（权重0.2）
   - 沪深300指数（权重0.5）
   - 上证50指数（权重0.2）
   - 金融指数（权重0.1）

2. **核心指标**：
   - GARCH波动率模型：估计条件波动率，区分上涨波动率和下跌波动率
   - RSI指标：使用21日EMA平滑处理，考虑顶背离和价格趋势
   - 布林带位置：价格相对均线的偏离程度
   - 成交量异动：相对于20日均线的成交量比率
   - 复合趋势检测：结合价格、成交量和RSI数据识别市场趋势

3. **改进特性**：
   - 混合归一化：使用动态窗口归一化处理各指标数据
   - S型钝化曲线：避免情绪指标出现过度敏感的极端值
   - 波动率过滤机制：在高波动期间降低情绪指标权重

## 交易信号与仓位管理

根据情绪指标得分，将买入信号分为三类：

1. **核心信号**（情绪分数 < 2.5）：
   - 最高权重（50%目标仓位）
   - 资金占比至少10%或50万元
   - 不受价格限制约束

2. **次级信号**（情绪分数 2.5-10）：
   - 中等权重（30%目标仓位）
   - 资金占比至少5%或20万元
   - 需满足价格低于持仓均价5%以上的条件

3. **轻仓信号**（情绪分数 10-15）：
   - 最低权重（10%目标仓位）
   - 需满足价格和波动率条件

## 止盈策略

设计了三层阶梯式止盈机制：

1. **一级止盈**（情绪分数 > 10）：
   - 减仓50%
   - 最小盈利要求1%

2. **二级止盈**（情绪分数 > 20）：
   - 减仓30%
   - 最小盈利要求1%

3. **三级止盈**（情绪分数 > 80）：
   - 全部清仓
   - 最小盈利要求1%

4. **动量保护机制**：
   - 当5日涨幅超过15%时减仓50%
   - 高波动环境（波动率>25%）减仓80%

## 风险控制机制

1. **最大回撤限制**：资产回撤超过15%时强制平仓
2. **趋势识别保护**：下跌趋势环境避免开仓
3. **追踪止损**：可选启用追踪止损功能，默认设置为2%
4. **T+1交易限制**：符合中国A股市场T+1交易规则
5. **价格涨跌停限制**：价格变动超过10%时不交易

## ETF分红处理

策略内置ETF分红处理功能：

1. 自动获取并缓存ETF历史分红数据
2. 在分红日调整持仓成本和现金
3. 分红收益单独统计，与价格收益分开计算

## 参数设置

主要参数包括：

```
# 情绪阈值参数
sentiment_core: 2.5       # 核心信号情绪阈值
sentiment_secondary: 10.0  # 次级信号情绪阈值
sentiment_warning: 15.0    # 预警信号情绪阈值
sentiment_sell_1: 10.0     # 第一阶段止盈阈值
sentiment_sell_2: 20.0     # 第二阶段止盈阈值
sentiment_sell_3: 80.0     # 第三阶段止盈阈值

# 仓位参数
position_core: 0.5         # 核心信号仓位比例
position_grid_step: 0.1    # 网格加仓步长
position_warning: 0.05     # 预警信号初始仓位
position_bb_signal: 0.1    # 布林带突破信号仓位

# 风险控制参数
min_momentum: -5.0         # 最小动量要求(10日涨跌幅)
vol_threshold: 25.0        # 高波动率阈值
quick_profit_days: 5       # 短期获利天数
quick_profit_pct: 15.0     # 短期获利比例阈值
high_vol_profit_pct: 20.0  # 高波动市场获利阈值
trail_percent: 2.0         # 追踪止损百分比
risk_ratio: 0.02           # 单次交易风险比率
max_drawdown: 0.15         # 最大回撤限制
```

## 策略逻辑流程

1. **数据准备**：
   - 获取市场情绪数据
   - 计算技术指标（RSI、布林带、波动率等）

2. **市场状态识别**：
   - 识别当前是否处于下跌趋势
   - 计算市场波动率环境

3. **交易信号生成**：
   - 根据情绪分数生成交易信号
   - 根据市场状态过滤信号

4. **仓位计算**：
   - 根据信号类型确定目标仓位
   - 根据波动率调整仓位规模

5. **执行交易**：
   - 计算实际交易数量
   - 执行买入或卖出操作

6. **止盈管理**：
   - 监控情绪指标变化
   - 达到阈值时执行阶梯式减仓

7. **风险控制**：
   - 监控回撤和止损条件
   - 必要时执行风险管理措施

## 适用场景

此策略适用于：

1. ETF等宽基指数产品交易
2. 中长期价值投资者的择时工具
3. 市场剧烈波动环境下的逆向投资
4. 与其他策略组合形成多策略投资组合

## 优势与局限性

**优势**：
- 利用市场情绪波动带来的投资机会
- 多维度技术指标综合评估，减少误判
- 动态仓位管理适应不同市场环境
- 阶梯式止盈保护收益

**局限性**：
- 依赖历史情绪数据的可靠性
- 仓位调整频率较高，可能增加交易成本
- 在趋势明确的单边市场中可能表现不佳
- 需要持续调整参数以适应不同市场环境

## 未来优化方向

1. 加入基本面数据作为辅助指标
2. 优化GARCH模型以提高波动率预测准确性
3. 引入机器学习方法动态调整参数
4. 拓展到更多资产类别的情绪预测
